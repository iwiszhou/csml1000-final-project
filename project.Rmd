---
title: "project"
output:
  html_document: default
  pdf_document: default
bibliography: reference.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Problem Statement
This dataset includes data on adult's diet, physical activity, and weight status from Behavioral Risk Factor Surveillance System. This data is used for DNPAO's Data, Trends, and Maps database, which provides national and state specific data on obesity, nutrition, physical activity, and breastfeeding.  The dataset provider is particularly curious on whether socioeconomic status has an impact on obesity.  In her analysis, she compares the obesity rate in each state, and then perform a linear regression on the obesity rate for each educational status and the income bracket. [@Suzanne] 


## Approach
  1.  **Import the source file** - Nutrition__Physical_Activity__and_Obesity_-_Behavioral_Risk_Factor_Surveillance_System.csv:
```{r step1, echo=FALSE, include=FALSE}
library(tidyverse)
library(dplyr)
df <- read_csv("Nutrition__Physical_Activity__and_Obesity_-_Behavioral_Risk_Factor_Surveillance_System.csv")
df %>% 
  print(n = 10, width = Inf)
problems(df)

comma <- function(x)  format(x, digits = 2, big.mark = ",")

```
     The source file has `r comma(nrow(df))` rows and `r comma(ncol(df))` columns
     
  2. **Clean dataset** 
      * **Column Correlation:**
         + LocationAbbr and LocationDesc:
```{r LocationCorr, echo=FALSE}
      df %>% select(LocationAbbr, LocationDesc) %>% count(LocationAbbr, LocationDesc) %>% 
         ggplot(aes(x=LocationAbbr, y=LocationDesc)) +
          geom_tile(mapping = aes(fill = n))
```
         + Column Datasource 
```{r DatasourceCol, echo=FALSE}
        ggplot(data=df, mapping = aes(x=Datasource)) + 
            stat_count()
```
         + Class and Topic columns are correlated:
```{r classTopicCorr, echo=FALSE}
      ggplot(data=df, mapping = aes(x=Class, y=Topic)) +
        geom_count()
```
         + Data_Value is the mean of Low_Confidence_Limit and High_Confidence_Limit
```{r DataValueRel, echo=FALSE, warning=FALSE}
  temp_df <- df %>% select(Data_Value, Low_Confidence_Limit, High_Confidence_Limit) %>% mutate(row = row_number(), mean_value=(Low_Confidence_Limit +  High_Confidence_Limit)/2 ) 
  temp_df %>% ggplot(mapping=aes(x=Data_Value, y=mean_value)) + 
    geom_boxplot(mapping=aes(group=cut_number(Data_Value, 10)), na.rm = TRUE)

```
         
       
      * **Clean the columns:**
```{r dataStructure, echo=FALSE, results='asis' }
  library(knitr)
  dd <- tibble(
    colName = colnames(df),
    action = c("change to int",
               "remove, corelate with YearStart",
               "pass",
               "remove, correlate with LocationAbbr",
               "remove, may not relate to the problem",
               "remove, correlate with TopicID",
               "remove, because corelate to Class",
               "remove, correlate with QuestionID",
               "remove, contain only NA",
               "remove, contains only value 'Value'",
               "remove 'NA' observations",
               "remove, corelate to Data_Value",
               "remove, correlate to Data_Value_Footnote",
               "remove, contain only NA after removing Data_Value NA obs",
               "remove, Data_Value = mean(Low_confidence_Limit, High_Confidence_Limit)",
               "remove, Data_Value = mean(Low_confidence_Limit, High_Confidence_Limit)",
               "pass",
               "update NA -> 'Unknown'",
               "update colname -> Age, update NA-> 'Unknown'",
               "update NA -> 'Unknown",
               "update NA -> 'Unknown",
               "update NA -> 'Unknown'",
               "update colname -> 'Race' and update NA -> 'Unknown'",
               "remove, correlate to LocationAbbr",
               "remove, correlate with col: TopicID",
               "pass",
               "pass",
               "remove, contain only one value 'VALUE'",
               "remove, corelated with column GeoLocation",
               "remove, corelation with StratificationCategoryId1",
               "remove, corelation with Income, Race/Ethnicity, Gender, Education, Age, Total, sub catigory under spread StratificationCategoryId1",
               "remove, gathered columns from OVR,GEN,EDU,AGEYR,INC,RACE",
               "remove, combined col: StratificationCategoryId1 + Stratification1"
    )
  )
  kable(dd, caption="column list")
```
```{r tidyColumns, echo=FALSE}
    replaceNA <- function(df, colName, value='Unknown') {
      df[[colName]] <- ifelse( is.na(df[[colName]]), value, df[[colName]])
      return(df)
    }

    #replaceNA(df=df, colName = "Data_Value_Footnote", "" )

    clean_df <- df %>%
      select( -YearEnd, -LocationDesc, -Datasource, -Class, -Topic, -Question, -Data_Value_Unit, -Data_Value_Type, -Data_Value_Alt,
              -Data_Value_Footnote_Symbol, -Data_Value_Footnote, -GeoLocation, -ClassID, -DataValueTypeID, -LocationID, 
              -StratificationCategory1, -Stratification1, -StratificationCategoryId1, -StratificationID1, 
              -High_Confidence_Limit, -Low_Confidence_Limit ) %>%
      rename( Age = `Age(years)`,  Race = `Race/Ethnicity` )
    
    clean_df <- clean_df %>% replaceNA(. , colName = "Total") %>% replaceNA(. , colName = "Age") %>%  replaceNA(. , colName = "Education") %>%
                replaceNA(. , colName = "Gender") %>% replaceNA(. , colName = "Income") %>% replaceNA(. , colName = "Race") %>%
                filter( !is.na(Data_Value) )
    
    clean_df <- clean_df %>% mutate( YearStart = as.integer(YearStart) )
    
```

*References*